<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link type="application/atom+xml" rel="alternate" href="https://ruabraun.github.io/feed.xml" title="Sharings" />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Notes on Decoupled Contrastive Learning | Sharings</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Notes on Decoupled Contrastive Learning" />
<meta name="author" content="Rudolf A. Braun" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Trying to summarize the recent paper Decoupled Contrastive Learning." />
<meta property="og:description" content="Trying to summarize the recent paper Decoupled Contrastive Learning." />
<link rel="canonical" href="https://ruabraun.github.io/jekyll/update/2021/10/15/Notes-on-Decoupled-Contrastive-Learning.html" />
<meta property="og:url" content="https://ruabraun.github.io/jekyll/update/2021/10/15/Notes-on-Decoupled-Contrastive-Learning.html" />
<meta property="og:site_name" content="Sharings" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-15T10:06:02+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Notes on Decoupled Contrastive Learning" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Notes on Decoupled Contrastive Learning","dateModified":"2021-10-15T10:06:02+00:00","datePublished":"2021-10-15T10:06:02+00:00","author":{"@type":"Person","name":"Rudolf A. Braun"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ruabraun.github.io/jekyll/update/2021/10/15/Notes-on-Decoupled-Contrastive-Learning.html"},"description":"Trying to summarize the recent paper Decoupled Contrastive Learning.","url":"https://ruabraun.github.io/jekyll/update/2021/10/15/Notes-on-Decoupled-Contrastive-Learning.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/pure-min.css" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/grids-responsive-min.css">
  <link rel="stylesheet" href="/assets/css/open-color.css">
  <link rel="stylesheet" href="/assets/css/hydure.css">

  <script async src="https://use.fontawesome.com/releases/v5.12.0/js/all.js"></script>

  

</head>


  <body>
    <div id="layout" class="pure-g">
      <div class="sidebar pure-u-1 pure-u-md-1-4" style="background-color: #202421">
        <div class="sidebar-shield">
          <header class="header">
  <img src="https://ruabraun.github.io/images/profpic.jpg" alt="Me!" width="40%" height="40%" class="profile">
  <a class="brand-title" href="/">Sharings</a>
  <p class="brand-name">Rudolf A. Braun</p>
  <p class="brand-tagline">On speech recognition and maybe other things</p>

  
    <nav class="nav pure-menu">
      <ul class="pure-menu-list">
      
        <li class="nav-item pure-menu-item">
          <a href="/" class="pure-menu-link ">
            Home
          </a>
        </li>
      
        <li class="nav-item pure-menu-item">
          <a href="/about/" class="pure-menu-link ">
            About
          </a>
        </li>
      
      </ul>
    </nav>
  

  
    <div class="social pure-menu pure-menu-horizontal">
      <ul class="social-list pure-menu-list">
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="mailto:rab014@gmail.com" target="_blank">
              <i class="fas fa-envelope" title="Email"></i>
            </a>
          </li>
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="https://twitter.com/fasttosmile" target="_blank">
              <i class="fab fa-twitter" title="Twitter"></i>
            </a>
          </li>
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="https://github.com/RuABraun/" target="_blank">
              <i class="fab fa-github" title="GitHub"></i>
            </a>
          </li>
        
          <li class="social-item pure-menu-item">
            <a class="pure-menu-link pure-button" href="https://www.linkedin.com/in/rudolf-a-braun-speech/" target="_blank">
              <i class="fab fa-linkedin" title="LinkedIn"></i>
            </a>
          </li>
        
      </ul>
    </div>
  
</header>

        </div>
      </div>
      <div class="content pure-u-1 pure-u-md-3-4">
        <div class="main">
          <article class="post">
  
    <div class="post-meta">
      <ul class="post-categories"><li>
            <span class="post-category">jekyll</span></li><li>
            <span class="post-category">update</span></li></ul>
    </div>
  
  <h1 class="post-title">Notes on Decoupled Contrastive Learning</h1>
  <div class="post-meta">
    <time datetime="2021-10-15T10:06:02+00:00" itemprop="datePublished">
      15 Oct 2021
    </time></div>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  
  <p>Trying to summarize the recent paper <a href="https://arxiv.org/abs/2110.06848">Decoupled Contrastive Learning</a>.</p>

<p>The contrastive loss is defined as 
\(L_i=-\log \frac{e^{z_i^{(1)} \cdot z_i^{(2)} / \tau }}{\sum_j e^{z_i^{(1)} \cdot z_j^{(2)} / \tau}}\)</p>

<p>for one positive pair \(z_i^{(1)}, z_i^{(2)}\). Minimizing the loss means the numerator needs to be increased (by increasing the dot product of the positive pair) while decreasing the denominator (decreasing dot product of negative pairs). As the loss goes down the ratio should go to 1.</p>

<p>Through some rearranging they find that there’s a shared term in the gradients of \(z_i^{(1)}, z_i^{(2)}, z_j\):</p>

\[q_B^{1} = 1 - \frac{e^{z_i^{(1)} \cdot z_i^{(2)} / \tau }}{\sum_j e^{z_i^{(1)} \cdot z_j^{(2)} / \tau}}\]

<p>The fraction is the same as in the loss. So when the ratio is close to 1 the gradient is small. The end result is that if there are no difficult negatives then the gradient will be small. Even if the positive pair is not that close to each other!
This slows learning down and is why large batch sizes were required to ensure the existence of hard negatives.</p>

<p>They empirically show that when using small batch sizes the distribution of \(q_B\) has a strong bias towards small values («0.5). This changes as the batch is increased.</p>

<p>They propose removing the positive pair from the denominator:
\(L_i^{DCL}=-\log \frac{e^{z_i^{(1)} \cdot z_i^{(2)} / \tau }}{\sum_{j \ne i} e^{z_i^{(1)} \cdot z_j^{(2)} / \tau}}\)</p>

<p>And a weighting function to ensure that the gradient is larger when positive samples are further from each other.</p>

<p>Experiments show learning is faster.</p>

<p>Personal thoughts: I had wondered whether it might be suboptimal to include the positive pair in the denominator! Interesting to see this feeling validated! I hesitated pursuing this because allowing the ratio inside the log to be larger than 1 seemed wrong.</p>



  

  
</article>

        </div>
        <footer class="footer pure-g">
  <div class="pure-u-1 pure-u-md-1-2">
    <small>
      &copy;&nbsp;<time datetime="2020-10-04T12:40:02+00:00">2020</time>-<time datetime="2021-11-21T16:19:33+00:00">2021</time>&nbsp;<a href="" target="_blank">Rudolf A. Braun</a>. All right reserved.
    </small>
  </div>

  <div class="pure-u-1 pure-u-md-1-2">
    <small>
      Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & <a href="https://github.com/zivong/jekyll-theme-hydure" target="_blank">Hydure</a>
    </small>
  </div>
</footer>

      </div>
    </div>

    

    
  </body>
</html>
