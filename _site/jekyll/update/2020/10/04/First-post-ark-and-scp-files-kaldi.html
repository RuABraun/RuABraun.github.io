<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>First post: Ark and scp files in kaldi | Blog? blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="First post: Ark and scp files in kaldi" />
<meta name="author" content="Rudolf Arseni Braun" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Both file types are organized by having keys and values for each key." />
<meta property="og:description" content="Both file types are organized by having keys and values for each key." />
<link rel="canonical" href="http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html" />
<meta property="og:site_name" content="Blog? blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-04T14:40:02+02:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html"},"headline":"First post: Ark and scp files in kaldi","dateModified":"2020-10-04T14:40:02+02:00","datePublished":"2020-10-04T14:40:02+02:00","author":{"@type":"Person","name":"Rudolf Arseni Braun"},"description":"Both file types are organized by having keys and values for each key.","url":"http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=71f94425de31950595fc47df52580557613d60c7">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">Blog? blog</a></h1>
      

      <p>Both file types are organized by having keys and values for each key.</p>

<h1 id="scp-files">Scp files</h1>

<p>Scp files, usually ending with the “.scp” suffix, always reserve the first field in a line (a field is a word separated by spaces, you could also call it column) for a key (usually an utterance ID). The rest of the line is treated as a pointer to data (is the value). 
What this means is that the scp file never contains any data, it just contains something which points to it (the data). See for example the wav.scp file which will look something like this usually:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wav-id-1 /path/to/file-1.wav
wav-id-2 /path/to/file-2.wav
wav-id-3 /path/to/file-3.wav
</code></pre></div></div>

<p>It can be a file path, but can also be more complex like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wav-id-1 sox /path/to/file-1.wav -r 8k - |
</code></pre></div></div>
<p>Kaldi’s code is written so that it will recognize and execute the above command (starting from after the key), which results in the wav file being read with a sampling rate of 8kHz. This is a convenient way of doing the resampling on the fly (instead of resampling and having to waste space storing it somewhere).</p>

<p>Another file one will see a lot when using kaldi is the <code class="language-plaintext highlighter-rouge">feats.scp</code> file which looks like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>utt-id-1 /path/to/file-1.ark:44
utt-id-2 /path/to/file-1.ark:760
utt-id-3 /path/to/file-1.ark:1520
</code></pre></div></div>
<p>The number after the <code class="language-plaintext highlighter-rouge">:</code> is a byte offset.</p>

<h1 id="ark-files">Ark files</h1>

<p>Instead of the value being a pointer to the data, in ark files the value <strong>is</strong> the data. Usually this means it is in binary format, so you can’t visually inspect it, however kaldi has binaries for converting from binary to text format. So for example take the ark file from the feats.scp example above and call:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy-feats ark:/path/to/file-1.ark ark,t:/path/to/file-1.ark.txt
</code></pre></div></div>

<p>Note the <code class="language-plaintext highlighter-rouge">ark,t</code> means that the values in the output will be written in textual format, so you can open the file and see what the values for the (example) MFCC coefficients are for each frame.</p>

<p>Another example of an ark style file, although it doesn’t have the “.ark” suffix, is the <code class="language-plaintext highlighter-rouge">text</code> file you will find in kaldi data folders. The first field/column is the utterance ID, the rest of the line is the words belonging to that utterance. The words are the data.</p>

<hr />

<p>Kaldi has a script for subsetting <code class="language-plaintext highlighter-rouge">scp</code> files you may find useful called <code class="language-plaintext highlighter-rouge">utils/subset_scp.pl</code>.</p>

<p>When you call kaldi binaries you often have to prefix with <code class="language-plaintext highlighter-rouge">ark:</code> or <code class="language-plaintext highlighter-rouge">scp:</code> to tell kaldi what type of file to expect. You can then mix types, for example I could use <code class="language-plaintext highlighter-rouge">utils/subset_scp.pl</code> to subset <code class="language-plaintext highlighter-rouge">feats.scp</code> and create a file called <code class="language-plaintext highlighter-rouge">feats_subset.scp</code>, and then copy a subset of the feature data by calling</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy-feats scp:feats_subset.scp ark:copied_feats_subset.ark
</code></pre></div></div>
<p>Notice how the input argument is <code class="language-plaintext highlighter-rouge">scp</code>, so kaldi knows the input file is pointing to the data I want to use, and the output is <code class="language-plaintext highlighter-rouge">ark</code>, so kaldi knows to actually write the data pointed to to a new file.</p>

<p>It’s not possible to create just a <code class="language-plaintext highlighter-rouge">scp</code> file from an <code class="language-plaintext highlighter-rouge">ark</code> file, you have to create both the <code class="language-plaintext highlighter-rouge">ark</code> and <code class="language-plaintext highlighter-rouge">scp</code> files. So you have to do something like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy-feats scp:/path/to/feats.ark ark,scp:copied_feats.ark,copied_feats.scp 
</code></pre></div></div>



      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
