<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>First post: Ark and scp files in kaldi | Blog? blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="First post: Ark and scp files in kaldi" />
<meta name="author" content="Rudolf Arseni Braun" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Both file types are organized by having keys and values (for each key)." />
<meta property="og:description" content="Both file types are organized by having keys and values (for each key)." />
<link rel="canonical" href="http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html" />
<meta property="og:url" content="http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html" />
<meta property="og:site_name" content="Blog? blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-04T14:40:02+02:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html"},"datePublished":"2020-10-04T14:40:02+02:00","author":{"@type":"Person","name":"Rudolf Arseni Braun"},"headline":"First post: Ark and scp files in kaldi","dateModified":"2020-10-04T14:40:02+02:00","description":"Both file types are organized by having keys and values (for each key).","url":"http://localhost:4000/jekyll/update/2020/10/04/First-post-ark-and-scp-files-kaldi.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Blog? blog" />





<!-- Google Fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open%20Sans|Roboto|Roboto%20Slab|Roboto%20Mono|Dancing%20Script|Noto%20Sans%20SC|Noto%20Sans%20TC|Noto%20Serif%20SC|Noto%20Serif%20TC|Ma%20Shan%20Zheng">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/skin.css">

<!-- Begin selecting skin -->

<!-- End selecting skin -->

<script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>




  </head>

  <body>
    <div class="site-container">
      <header class="site-header">
        <div class="wrapper">
  <script>
    function clickSidebarButton() {
      const elem = document.getElementById("site-sidebar")
      if (elem.style.display == "none" || elem.style.display == "") {
        elem.style.display = "block";
      } else {
        elem.style.display = "none";
      }
    }
  </script>
  <a class="site-sidebar-button" onclick="clickSidebarButton()"><i class="far fa-user"></i>
  </a>

  <a class="site-title" rel="author" href="/">Blog? blog</a>

  
    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger" title="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <ul class="trigger">
              <li><a class="" href="/about/">About</a></li>
            </ul>
    </nav>
  
</div>

      </header>
      
      <div class="site-body wrapper">
        <aside class="site-sidebar" id="site-sidebar">
          

<div class="sidebar-section">
  <ul class="contact-list">
    <li>
        <i class="sidebar-icon fas fa-at"></i>
        <span class="contact-info p-name">Rudolf Arseni Braun</span>
      </li>
    <li>
        <i class="sidebar-icon fas fa-envelope"></i>
        <a class="contact-info u-email" href="mailto:rab014@gmail.com">rab014@gmail.com</a>
      </li>
    <li>
        <i class="sidebar-icon fas fa-location-arrow"></i>
        <a class="contact-info u-location" href="https://www.google.com/maps/search/Montreux">Montreux</a>
      </li>
  </ul>
</div>

<div class="sidebar-section desc">
  <p>Speech Recognition guy in Switzerland with a lot of hobbies.</p>
</div>

<div class="sidebar-section">
    <ul class="social-icons">
      <li>
          <a class="social-icon" href="https://twitter.com/latetosmile"><i class="fab fa-twitter fa-2x" title="Twitter"></i></a>
        </li><li>
          <a class="social-icon" href="https://www.linkedin.com/in/rudolf-a-braun-speech/"><i class="fab fa-linkedin fa-2x" title="LinkedIn"></i></a>
        </li><li>
          <a class="social-icon" href="https://github.com/RuABraun"><i class="fab fa-github fa-2x" title="Github"></i></a>
        </li><li>
          <a class="social-icon" href="https://gitlab.com/adivin"><i class="fab fa-gitlab fa-2x" title="Gitlab"></i></a>
        </li>
    </ul>
  </div>

        </aside>
        <main class="site-main" id="site-main" aria-label="Content">
          <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

    <h1 class="post-title p-name" itemprop="name headline">First post: Ark and scp files in kaldi</h1>
    <p class="post-meta"><time class="dt-published" datetime="2020-10-04T14:40:02+02:00" itemprop="datePublished">
        Oct 4, 2020
      </time></p>

  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Both file types are organized by having keys and values (for each key).</p>

<h1 id="scp-files">Scp files</h1>

<p>Scp files, usually ending with the “.scp” suffix, the first column (or field) is the key (usually an utterance ID). The rest of the line is treated as a pointer to data (the pointer is the value). 
What this means is that the scp file never contains any data, it just contains something which points to it (the data). See for example the wav.scp file which will look something like this usually:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wav-id-1 /path/to/file-1.wav
wav-id-2 /path/to/file-2.wav
wav-id-3 /path/to/file-3.wav
</code></pre></div></div>

<p>It can be a file path, but can also be more complex like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wav-id-1 sox /path/to/file-1.wav -r 8k - |
</code></pre></div></div>
<p>Kaldi’s code is written so that it will recognize and execute the above command (starting from after the key), which results in the wav file being read with a sampling rate of 8kHz. This is a convenient way of doing the resampling on the fly (instead of resampling and having to waste space storing it somewhere).</p>

<p>Another file one will see a lot when using kaldi is the <code class="language-plaintext highlighter-rouge">feats.scp</code> file which looks like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>utt-id-1 /path/to/file-1.ark:44
utt-id-2 /path/to/file-1.ark:760
utt-id-3 /path/to/file-1.ark:1520
</code></pre></div></div>
<p>The number after the <code class="language-plaintext highlighter-rouge">:</code> is a byte offset.</p>

<h1 id="ark-files">Ark files</h1>

<p>Instead of the value being a pointer to the data, in ark files the value <strong>is</strong> the data. Usually this means it is in binary format, so you can’t visually inspect it, however kaldi has binaries for converting from binary to text format. So for example take the ark file from the feats.scp example above and call:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy-feats ark:/path/to/file-1.ark ark,t:/path/to/file-1.ark.txt
</code></pre></div></div>

<p>Note the <code class="language-plaintext highlighter-rouge">ark,t</code> means that the values in the output will be written in textual format, so you can open the file and see what the values for the (example) MFCC coefficients are for each frame.</p>

<p>Another example of an ark style file, although it doesn’t have the “.ark” suffix, is the <code class="language-plaintext highlighter-rouge">text</code> file you will find in kaldi data folders. The first field/column is the utterance ID, the rest of the line is the words belonging to that utterance. The words are the data.</p>

<hr />

<p>Kaldi has a script for subsetting <code class="language-plaintext highlighter-rouge">scp</code> files you may find useful called <code class="language-plaintext highlighter-rouge">utils/subset_scp.pl</code>.</p>

<p>When you call kaldi binaries you often have to prefix with <code class="language-plaintext highlighter-rouge">ark:</code> or <code class="language-plaintext highlighter-rouge">scp:</code> to tell kaldi what type of file to expect. You can then mix types, for example I could use <code class="language-plaintext highlighter-rouge">utils/subset_scp.pl</code> to subset <code class="language-plaintext highlighter-rouge">feats.scp</code> and create a file called <code class="language-plaintext highlighter-rouge">feats_subset.scp</code>, and then copy a subset of the feature data by calling</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy-feats scp:feats_subset.scp ark:copied_feats_subset.ark
</code></pre></div></div>
<p>Notice how the input argument is <code class="language-plaintext highlighter-rouge">scp</code>, so kaldi knows the input file is pointing to the data I want to use, and the output is <code class="language-plaintext highlighter-rouge">ark</code>, so kaldi knows to actually write the data pointed to to a new file.</p>

<p>It’s not possible to create just a <code class="language-plaintext highlighter-rouge">scp</code> file from an <code class="language-plaintext highlighter-rouge">ark</code> file, you have to create both the <code class="language-plaintext highlighter-rouge">ark</code> and <code class="language-plaintext highlighter-rouge">scp</code> files. So you have to do something like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy-feats scp:/path/to/feats.ark ark,scp:copied_feats.ark,copied_feats.scp 
</code></pre></div></div>

<p>For more details check out the official documentation of <a href="http://kaldi-asr.org/doc/io.html">kaldi io</a>. Probably the section “from a command-line perspective” is more relevant to you.</p>

  </div>

  <footer class="post-footer">
    
      <div class="post-meta">
        <i class="fas fa-folder"></i>
        <ul class="post-taxonomies post-categories">
          
          
            <li class="post-category">
              
              <a href="/categories/#jekyll">jekyll</a>
            </li>
          
            <li class="post-category">
              
              <a href="/categories/#update">update</a>
            </li>
          
        </ul>
      </div>
    

    

    <nav class="post-pagination" role="navigation">
      
    
      
    </nav>
  </footer>

  
  
</article>

          <footer class="site-footer">
            <div class="footer-col-wrapper">

  <div class="footer-col">
    <div class="copyright">
      
      
      
      
      <p>Copyright © 2020 Rudolf Arseni Braun; All rights reserved.</p>
      
    </div>
    <p>
      Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://github.com/ngzhio/jekyll-theme-hamilton">Hamilton</a>
    </p>
  </div>

  <div class="footer-col">
    <p></p>
  </div>
</div>

          </footer>
        </main>
      </div>
    </div>
  </body>

</html>
